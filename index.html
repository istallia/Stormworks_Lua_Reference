<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Stormworks Lua Reference</title>
	<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
	<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.21.0/themes/prism-coy.min.css" rel="stylesheet" />
	<link rel="stylesheet" href="./main.css">
</head>
<body>
<div class="container">

	<header class="row">
		<h1 class="col">Stormworks(v1.0.1) Lua Reference</h1>
	</header>

	<div class="row">
		<div class="col m12">
			<div class="card">
				<div class="card-content">
					<span class="card-title">Lua Scripting Overview</span>
					<p>
						Luaスクリプティングはあなたに高度なミッションやカスタムゲームモードを作るためのツールを提供します。<br>
						Stormworksでは、あなたのスクリプトがゲームを操作できるようないくつもの機能を提供しています。
					</p>
					<p>
						このガイドは利用可能な関数について説明しますが、Luaスクリプティングを始めるためのチュートリアルではありません。
					</p>
				</div>
			</div>
		</div>
		<div class="col m12">
			<div class="card">
				<div class="card-content">
					<span class="card-title">Callback Functions</span>
					<p>
						以下は条件を満たした際に自動的に呼ばれる、スクリプトで使えるコールバック関数です。<br>
						最もシンプルなコールバック関数は<code>onTick</code>で、ゲーム内tick毎に呼び出されます。
					</p>
					<pre class="pre-line">
						<code class="language-lua">
							function onTick(game_ticks)
							function onCreate()
							function onDestroy()
							function onCustomCommand(full_message, user_peer_id, is_admin, is_auth, command, args ...)
							function onChatMessage(sender_name, message)
							function onPlayerJoin(steam_id, name, peer_id, is_admin, is_auth)
							function onPlayerSit(peer_id, vehicle_id, seat_name)
							function onPlayerRespawn(peer_id)
							function onPlayerLeave(steam_id, name, peer_id, is_admin, is_auth)
							function onSpawnVehicle(vehicle_id, peer_id, x, y, z)
							function onTeleportVehicle(vehicle_id, peer_id, x, y, z)
							function onDespawnVehicle(vehicle_id, peer_id)
							function onSpawnMessionObject(object_id, name, OBJECT_TYPE, playlist_name)
							function onVehicleDamaged(vehicle_id, damage)
							function httpReply(port, request, reply)
							function onFireExtinguished(x, y, z)
						</code>
					</pre>
					<p>
						<code>onCustomCommand</code>は「?」から始まるチャットのメッセージを検出できる柔軟な関数です。
					</p>
				</div>
			</div>
		</div>
		<div class="col m12">
			<div class="card">
				<div class="card-content">
					<span class="card-title">Server Functions</span>
					<p>
						以下のいくつかの関数はすべて大文字の引数を含みます。それらの変数の説明は後述します。
					</p>
					<pre class="pre-line">
						<code class="language-lua">
							-- UI
							server.announce(name, message)
							server.whisper(peer_id, message)
							server.notify(peer_id, title, message, NOTIFICATION_TYPE)
							ui_id = ui.getMapID()
							server.removeMapID(peer_id, ui_id)
							server.addMapObject(peer_id, ui_id, POSITION_TYPE, MARKER_TYPE, x, y, z, parent_local_x, parent_local_y, parent_local_z, vehicle_id, object_id, label, vehicle_parent_id, radius, hover_level)
							server.removeMapObject(peer_id, ui_id)
							server.addMapLabel(peer_id, ui_id, LABEL_TYPE, name, x, y, z)
							server.removeMapLabel(peer_id, ui_id)
							server.addMapLine(peer_id, ui_id, start_matrix, end_matrix, width)
							server.removeMapLine(peer_id, ui_id)
							server.setPopup(peer_id, ui_id, name, is_show, text, x, y, z, is_worldspace, render_distance)
							server.removePopup(peer_id, ui_id)
							server.createPopup(peer_id, ui_id)
						</code>
					</pre>
					<pre class="pre-line">
						<code class="language-lua">
							-- Player
							name = server.getPlayerName(peer_id)
							PLAYER_LIST = server.getPlayers()
							matrix = server.getPlayerPos(peer_id)
							server.teleportPlayer(peer_id, matrix)
							server.killPlayer(peer_id)
							server.setSeated(peer_Id, vehicle_id, seat_name)
							x,y,z = server.getPlayerLookDirection(peer_id)
						</code>
					</pre>
					<pre class="pre-line">
						<code class="language-lua">
							-- Vehicle
							vehicle_id = server.spawnVehicle(matrix, playlist_index, component_id)
							vehicle_id = server.spawnVehicleSavefile(matrix, save_name)
							server.despawnVehicle(vehicle_id, is_instant)
							matrix = server.getVehiclePos(vehicle_id, voxel_x = 0, voxel_y = 0, voxel_z = 0)
							name = server.getVehicleName(vehicle_id)
							server.teleportVehicle(matrix, vehicle_id)
							server.c1eanVehicles()
							server.pressVehicleButton(vehicle_id, button_name)
							server.getVehicleFireCount(vehicle_id)
							server.setVehicleTooltip(vehicle_id, text)
							is_simulating = server.getVehicleSimulating(vehicle_id)
							server.setVehicleTransponder(vehicle_id, is_active)
							server.setVehicleEditable(vehicle_id, is_editable)
						</code>
					</pre>
					<pre class="pre-line">
						<code class="language-lua">
							-- Mission
							path = server.getPlaylistPath(playlist_name, is_rom)
							server.spawnObject(matrix, OBJECT_TYPE)
							is_found, matrix = server.getObjectPos(object_id)
							object_id = server.spawnFire(matrix, size, magnitude, is_lit, is_initialzied, is_explosive, parent_vehicle_id, explosion_point, explosion_magnitude)
							server.despawnObject(object_id, is_instant)
							object_id = server.spawnCharacter(matrix, (outfit_id))
							object_id = server.spawnAnimal(matrix, animal_type, scale)
							server.despawnCharacter(object_id, is_instant)
							hp, matrix = server.getCharacterData(object_id)
							server.setCharacterData(object_id, hp, is_interactable)
							server.setCharacterItem(object_id, slot, EQUIPMENT_ID, is_active)
							tutorial_completed = server.getTutorial()
							ZONE_LIST = server.getZones(tag(s))
							is_in_zone = server.isInZone(matrix, zone_name)
							matrix = server.spawnMissionLocation(matrix, playlist_index, location_index)
							server.spawnMissionObject(matrix, playlist_index, location_index, object_index)
							server.despawnMissionObject(object_id, is_instant)
							count = server.getPlaylistCount()
							PLAYLIST_DATA = server.getPlaylistData(p1ay1ist_index)
							LOCATION_DATA = server.getLocationData(playlist_index, location_index)
							OBJECT_DATA = server.getLocationObjectData(playIist_index, location_index, object_index)
							server.setFireData(object_id, is_lit, is_explosive)
							is_lit = server.getFireData(object_id)
							matrix = server.getOceanTransform(matrix, min_search_range, max_search_range)
							is_in_area = server.isInTransformArea(matrix_object, matrix_zone, zone_x, zone_y, zone_z)
						</code>
					</pre>
					<pre class="pre-line">
						<code class="language-lua">
							-- Game
							server.setGameSetting(setting_name, bool)
							GAME_SETTINGS = server.getGameSettings()
							server.setCurrency(amount)
							amount = server.getCurrencg()
							days_survived = server.getDateValue()
							system_time = getTimeMillisec()
						</code>
					</pre>
				</div>
			</div>
		</div>
		<div class="col m12">
			<div class="card">
				<div class="card-content">
					<span class="card-title">About this page</span>
					<p>
						このページはゲーム内の公式Luaガイドを元に和訳し、ついでに「こんな情報もあったらいいな」を追記していく感じのページです。  
						そんな方はいないとは思いますが、<a href="https://github.com/istallia/Stormworks_Lua_Reference">GitHub</a>でホストしてるので、gitできる方は手伝ってくださるとありがたいです。(とりあえずは英文丸写しでもOKです)
					</p>
					<p>
						使用したもの...<br>
						<a href="https://materializecss.com">Materialize</a> - CSS Framework<br>
						<a href="https://prismjs.com">Prism</a> - Syntax Highlight
					</p>
				</div>
			</div>
		</div>
	</div>

	<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.21.0/components/prism-core.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.21.0/components/prism-lua.min.js"></script>

</div>
</body>
</html>